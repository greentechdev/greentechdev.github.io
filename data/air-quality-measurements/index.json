
{
  "name": "Air quality measurements",
  "updated": "2020-02-25 00:00:00 +0000 UTC",
  "description" : "Near real-time national air quality data from measuring stations",
  "permalink" : "/data/air-quality-measurements/",
  "tags": ["air","geo"],
  "content" : "\r\n# Air quality measurements\r\n\r\nThe air quality data provides information on levels of various air pollutants, including particles, nitrogen dioxide and ground-level ozone, in Swedish cities and in rural areas. The data is provided in cooperation with [SMHI](https://smhi.se).\r\n\r\nSee [Luftkvaliteten i realtid och preliminär statistik](https://www.naturvardsverket.se/Sa-mar-miljon/Klimat-och-luft/Statistik-om-luft/Luftkvaliteten-i-realtid/) for more information (Swedish).\r\n\r\n## Data quality\r\n\r\nNo information.\r\n\r\n## License & conditions \r\n\r\n{{< license-cc0 >}}\r\n\r\n## Data model\r\n\r\nThe data is based on the [Observations & Measurements](https://en.wikipedia.org/wiki/Observations_and_Measurements) model, and was originally made available via a [Sensor Observation Service (SOS)](https://en.wikipedia.org/wiki/Sensor_Observation_Service). The central terms to be aware of are therefore:\r\n\r\n![Air quality model](https://greentechdev.github.io/airqualitymodel.png)\r\n\r\n* Feature of interest (station) - the geographical location where measured\r\n* Phenomenon - the thing measured, e.g. the gas NO2\r\n* Procedure - metadata about the sensor or process the generates the data\r\n* Offering - categories of data offered by the service, e.g. satellite or station observations\r\n\r\n## Distributions\r\n\r\nThe data is made available via a HTTP/REST API.\r\n\r\n### REST API\r\n\r\n* [Download OpenAPI specification](https://raw.githubusercontent.com/greentechdev/greentechdev.github.io/master/air_quality_api.json)\r\n* [Improve this specification](https://github.com/greentechdev/greentechdev.github.io/edit/master/air_quality_api.json)\r\n\r\n## Example usage\r\n\r\nSee the following example for an illustration of how to use the API and data. It's written in JavaScript, so it's easy to try without downloading or installing anything. Click the button _\"Try it!\"_ below each block of code, or the link _\"Edit in JSFiddle\"_ in the top right corner of the live example to edit, run and play with them further.\r\n\r\n### Chart last 24h of NO2 at Hornsgatan\r\n\r\nSay we're looking to chart the levels of NO2 (nitrogen dioxide) at Hornsgatan, Stockholm for the last 24 hours and compare it to the the threshold value from the [environmental quality standards](https://www.naturvardsverket.se/Stod-i-miljoarbetet/Vagledningar/Luft-och-klimat/Miljokvalitetsnormer-for-utomhusluft/Gransvarden-malvarden-utvarderingstrosklar/). Something like\r\n\r\n[Demo](https://jsfiddle.net/0dax5c3L/4/)\r\n\r\nSo in three simple steps:\r\n\r\n1) Using the Search-resource to find the NO2 phenomenon:\r\n\r\n    ```js\r\n    //make a search query for our term NO2\r\n    fetch(\"https://shair.smhi.se/52North/api/v1/search?q=NO2\")\r\n      .then(response => response.json())\r\n      .then(data => document.getElementById(\"results\").innerHTML = JSON.stringify(data, null, 2));\r\n    ```\r\n    in the resultset we have a match - the NO2 phenomenon has the ID = 8  \r\n    ```js  \r\n    {\r\n      \"id\": \"8\",\r\n      \"label\": \"NO2\",\r\n      \"href\": \"./phenomena/8\",\r\n      \"type\": \"phenomenon\"\r\n    }\r\n    ```\r\n\r\n1) Using the Station-resource to find a station monitoring our phenomena close to Hornsgatan\r\n    ```js\r\n    //URL to find stations filtered by our phenomenon ID \r\n    var url = \"https://shair.smhi.se/52North/api/v1/stations/?phenomena=8\";\r\n    //Using the \"near\"-parameter in the API to filter the list of stations by closeness to a point on a map we pick \r\n    var nearFilter = {\r\n        \"center\": {\r\n          \"type\": \"Point\",\r\n          \"coordinates\": [18.0486603472042, 59.3172224331124] //Lon-Lat for a point close to Hornsgatan (easy to get from Google maps or similar)\r\n        },\r\n        \"radius\": 1 //search radius in kilometers\r\n      }\r\n\r\n    //Prepare the parameter for use in the URL\r\n    nearFilter = encodeURIComponent(JSON.stringify(nearFilter));\r\n\r\n    //Append our near filter to the URL   \r\n    url += \"&near=\" + nearFilter;\r\n    //Fetch the filtered list of stations\r\n    fetch(url)\r\n      .then(response => response.json())\r\n      .then(data => document.getElementById(\"results\").innerHTML = JSON.stringify(data, null, 2));\r\n    ```\r\n    in the resultset we pick this station:\r\n\r\n    ```js\r\n    {\r\n      \"type\": \"Feature\",\r\n      \"id\": \"115\",\r\n      \"properties\": {\r\n        \"id\": \"115\",\r\n        \"label\": \"Stockholm Hornsgatan 108 Gata - 115\"\r\n      }\r\n      ...\r\n    }\r\n    ```\r\n1) Using the Timeseries-resource to get our measurment data\r\n    ```js\r\n    //With our phenomenon- and station ID - see what timeseries there are  \r\n    fetch(\"https://shair.smhi.se/52North/api/v1/timeseries/?phenomena=8&station=115\")\r\n      .then(response => response.json())\r\n      .then(data => document.getElementById(\"results\").innerHTML = JSON.stringify(data, null, 2));\r\n    ```\r\n    There is one such item - with ID = 59:\r\n    ```js\r\n    {\r\n    \"id\": \"59\",\r\n    \"label\": \"NO2 SPP-SE0003A_00008_100_100, Stockholm Hornsgatan 108 Gata - 115, SPP-SE0003A_00008_100_100\",\r\n    \"uom\": \"µg/m3\",\r\n    ...\r\n    ```\r\n    Now let's get the data for this timeseries (ID = 59) and plot it on a chart. We'll use the \"timespan\"-parameter to limit the results to a day back from now. This example uses the ChartJS-library.\r\n\r\n    ```js\r\n    //Create from and to-dates for the \"timespan\" API-parameter\r\n    var toDate = new Date();\r\n    var fromDate = new Date();\r\n    fromDate.setDate(toDate.getDate() - 1);\r\n\r\n    //Create URL for our timeseries and with the create timespan dates\r\n    var url = \"https://shair.smhi.se/52North/api/v1/timeseries/59/getData?timespan=\" + fromDate.toISOString() + \"/\" + toDate.toISOString();\r\n\r\n    //Get the data\r\n    fetch(url)\r\n      .then(response => response.json())\r\n      .then(data => {\r\n\r\n        //Split timestamp and values into separate arrays to match the chart input\r\n        var labels = []\r\n        var values = [];\r\n        data.values.forEach(function(item) {\r\n          labels.push(new Date(item.timestamp).toLocaleTimeString([], {\r\n            timeStyle: 'short'\r\n          }));\r\n          values.push(parseFloat(item.value));\r\n        });\r\n\r\n        //Create threshold data series for comparison, it only needs a start and end value. Source:\r\n        // https://www.naturvardsverket.se/Stod-i-miljoarbetet/Vagledningar/Luft-och-klimat/Miljokvalitetsnormer-for-utomhusluft/Gransvarden-malvarden-utvarderingstrosklar/\r\n        var thresholdHourValue = 90;\r\n        var thresholdHourValues = new Array(values.length - 1);\r\n        thresholdHourValues[0] = thresholdHourValue;\r\n        thresholdHourValues[values.length - 1] = thresholdHourValue;\r\n        var thresholdDayValue = 60;\r\n        var thresholdDayValues = new Array(values.length - 1);\r\n        thresholdDayValues[0] = thresholdDayValue;\r\n        thresholdDayValues[values.length - 1] = thresholdDayValue;\r\n\r\n        // Create the chart.js data structure using the labels, values and thresholdValues just created\r\n        var chartData = {\r\n          labels: labels,\r\n          datasets: [{\r\n              label: \"NO2\",\r\n              data: values,\r\n              borderColor: \"#61affe\",\r\n              backgroundColor: \"rgba(97,175,254,.2)\"            },\r\n            {\r\n              label: \"Hourly threshold value (90 µg/m3)\",\r\n              data: thresholdHourValues,\r\n              fill: '+1',\r\n              spanGaps: true,\r\n              borderColor: \"#E8A482\",\r\n              backgroundColor: \"rgba(232, 164, 130, 0.2)\"\r\n            },\r\n            {\r\n              label: \"Daily threshold value (60 µg/m3)\",\r\n              data: thresholdDayValues,\r\n              fill: false,\r\n              spanGaps: true\r\n            }\r\n          ]\r\n        };\r\n\r\n        //Get the context of the canvas element we want to draw the chart on\r\n        var ctx = document.getElementById(\"myChart\").getContext(\"2d\");\r\n\r\n        // Instantiate the chart\r\n        var mychart = new Chart(ctx, {\r\n          type: 'line',\r\n          data: chartData,\r\n          options: {\r\n            title: {\r\n              display: true,\r\n              text: 'Stockholm, Hornsgatan 108, ' + fromDate.toLocaleString() + ' - ' + toDate.toLocaleString(),\r\n            },\r\n            tooltips: {\r\n              enabled: true,\r\n            }\r\n          }\r\n        });\r\n      });\r\n    ```\r\n    Done!"
}
